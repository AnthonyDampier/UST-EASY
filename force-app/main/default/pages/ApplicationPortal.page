<apex:page controller="ApplicationPortal" showHeader="false" standardStylesheets="false" applyHtmlTag="false" lightningStyleSheets="true" docType="html-5.0" action="{!applicationPortalInit}">
    <apex:composition template="{!template}">
        <apex:define name="scriptsHead">
            <c:ApplicationHead />
        </apex:define>
        <apex:define name="body">
            <c:ApplicationBody title="Application Portal" appInfo="{!appInfo}">
                <apex:variable var="howManyApps" value="{!IF(!ISBLANK(applicationMapSize), applicationMapSize, 0)}"/>
                <div class="slds-grid slds-wrap {!IF(howManyApps >= 2, ' slds-gutters','')}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <apex:pageMessages />
                    <apex:variable var="checklistStyle" value="{!IF(howManyApps == 2, ' slds-large-size_6-of-12', ' slds-large-size_12-of-12')}"/>
                    <apex:variable var="checklistStyle" value="{!IF(howManyApps == 3, ' slds-large-size_4-of-12', checklistStyle)}"/>
                    <apex:repeat value="{!applicationsByIds}" var="key">
                        <apex:variable var="thisAppInfo" value="{!appInfoMapByAppId[key]}"/>
                        <apex:variable var="thisApp" value="{!applicationsByIds[key]}"/>
                        <apex:variable var="thisAppControl" value="{!thisAppInfo.appControl}"/>
                        <apex:variable var="thisIntendedProgram" value="{!thisApp.Intended_Program__r}"/>
                        <apex:variable var="thisChecklist" value="{!checklistsByAppIds[key]}"/>
                        <div class="slds-col slds-size_1-of-1{!checklistStyle}">
                            <article class="slds-card">
                                <div class="slds-card__header slds-grid">
                                    <header class="slds-media slds-media_center slds-has-flexi-truncate">
                                        <div class="slds-media__figure">
                                            <span class="slds-icon_container slds-icon-standard-account" title="account">
                                              <svg class="slds-icon slds-icon_small" aria-hidden="true">
                                                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/standard-sprite/svg/symbols.svg#account')}"></use>
                                              </svg>
                                              <span class="slds-assistive-text">
                                              <apex:outputPanel rendered="{!!thisAppControl.Hide_Term_Program__c}" layout="none">
                                                {!IF(ISBLANK( thisIntendedProgram.Program_Name_on_Application__c), thisIntendedProgram.Name, thisIntendedProgram.Program_Name_on_Application__c)}
                                                </apex:outputPanel>
                                              </span>
                                            </span>
                                        </div>
                                        <div class="slds-media__body">
                                            <h2 class="slds-card__header-title">
                                                <a href="#" class="slds-card__header-link slds-truncate" title="Applications">
                                                    <span>
                                                         <apex:outputPanel rendered="{!!thisAppControl.Hide_Term_Program__c}" layout="none">
                                                            {!IF(ISBLANK(thisIntendedProgram.Program_Name_on_Application__c), thisIntendedProgram.Name, thisIntendedProgram.Program_Name_on_Application__c)}
                                                         </apex:outputPanel>
                                                        <apex:outputPanel layout="none" rendered="{!!thisAppControl.Hide_Term_Program__c}">
                                                            ( {!key} )
                                                        </apex:outputPanel>
                                                    </span>
                                                </a>
                                            </h2>
                                        </div>
                                    </header>
                                </div>
                                <div class="slds-card__body slds-card__body_inner">
                                    <c:ApplicationChecklist appInfo="{!thisAppInfo}" checklistItems="{!thisChecklist}"/>
                                </div>
                                <footer class="slds-card__footer">
                                    <div class="slds-truncate" title="{!thisApp.Application_Status__c}">
                                        Application Status: {!thisApp.Application_Status__c}
                                    </div>
                                </footer>
                            </article>
                            <br/>
                        </div>
                    </apex:repeat>
                    <div class="slds-col slds-size_1-of-1 slds-large-size_12-of-12 slds-p-bottom_x-large">
                        <button class="slds-button slds-button_neutral slds-button_dual-stateful" aria-live="assertive" href="{!$Site.BaseUrl}/apex/ApplicationCreate?contactId={!appInfo.contactId}&at={!appInfo.at}">
                            <a href="{!$Site.BaseUrl}/apex/ApplicationCreate?contactId={!appInfo.contactId}&at={!appInfo.at}">
                                <svg class="slds-button__icon slds-button__icon_small slds-button__icon_left" aria-hidden="true">
                                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Asset.SLDS, 'assets/icons/utility-sprite/svg/symbols.svg#add')}"></use>
                                </svg>
                                New Application
                            </a>
                        </button>
                    </div>
                </div>
            </c:ApplicationBody>
        </apex:define>
    </apex:composition>
</apex:page>